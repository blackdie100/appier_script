import requests
from datetime import datetime,timedelta


NowTime = datetime.now() + timedelta(seconds=28800)
NowTimestamp = datetime.timestamp(NowTime)

reminder_StartTime = NowTime + timedelta(seconds=-18300)
reminder_EndTime = NowTime + timedelta(seconds=-17400)
reminder_StartTimestamp = datetime.timestamp(reminder_StartTime)
reminder_EndTimestamp = datetime.timestamp(reminder_EndTime)


Active = '11' ## 0 is inactive, 11 is active

reminder_url = "https://aiqua.appier.com/qganalyzedata/v2/campaigns/1212936/"

#on_the_day_payload = '{\n    \"active\": \"%s\",\n    \"id\": 794098,\n    \"type1\": \"inweb\",\n    \"name\": \"on_the_day\",\n    \"description\": \"Monday_Saturday_12am_14pm_\",\n    \"channel\": \"push\",\n    \"type\": \"web\",\n    \"include_segments\": [\n        124303,\n        124304\n    ],\n    \"exclude_segments\": [],\n    \"segment\": 124303,\n    \"includesegment\": null,\n    \"excludesegment\": null,\n    \"creative\": {\n        \"type\": \"inweb\",\n        \"triggerType\": \"scrollThreshold\",\n        \"startTime\": %d,\n        \"endTime\": %d,\n        \"include_new_users\": false,\n        \"whenCond\": {\n            \"eventName\": \"page_viewed\",\n            \"operator\": \"AND\",\n            \"conditions\": [\n                {\n                    \"value\": \"https://greenbox.tw/Products/SpecialNew\",\n                    \"param\": \"url\",\n                    \"op\": \"equals\"\n                },\n                {\n                    \"value\": \"https://greenbox.tw/Products/FrozenFood?categoryName=onsale\",\n                    \"param\": \"url\",\n                    \"op\": \"equals\"\n                }\n            ]\n        },\n        \"scheduledType\": \"repeats\",\n        \"maxNumTimesToShow\": 5,\n        \"audiencePlatform\": {\n            \"android\": true,\n            \"ios\": true,\n            \"others\": true\n        },\n        \"abCreativeVariants\": [\n            {\n                \"creativeType\": \"html\",\n                \"variantName\": \"變數 1\",\n                \"maxLeadSubmitCount\": 1,\n                \"html\": {\n                    \"htmlBody\": \"<div class=\\\"aiqua\\\">\\r\\n    <a class=\\\"aiqua__item-link\\\">\\r\\n      <img class=\\\"aiqua__item-img\\\" src=\\\"https://cdn.qgraph.io/img/hosting/6f8b1ea135c988f5f915/1S0Lbm0r1m5O1SkA1Y-T5KTD3g7Bd95xPcg4d95x1IPNd95AbSKcd95-0cKHjS2-d95AbS8Md95MbI5xd95-1S32dxrxbI3HbgrxbF0x0xrxbS1J1KrxbSs2P4erVSwM1okM1Sex1m1.jpg\\\" alt=\\\"\\\" />\\r\\n    </a>\\r\\n</div>\\r\\n\\r\\n\\r\\n<style>\\r\\n.aiqua {\\r\\n    max-width: 500px;\\r\\n    overflow: hidden;\\r\\n}\\r\\n\\r\\n.aiqua .aiqua__item-img {\\r\\n  width: %s;\\r\\n}\\r\\n</style>\",\n                    \"showOverlay\": false\n                }\n            }\n        ],\n        \"isAB\": false,\n        \"scrollTriggerRule\": {\n            \"percent\": 10\n        }\n    },\n    \"priority\": 1,\n    \"event\": \"nothing\",\n    \"trigger\": \"nothing\",\n    \"stats\": {\n        \"last_refresh_start_datetime\": \"2021-06-27 18:22:05\",\n        \"total_seg_duration\": 15,\n        \"pid\": \"568\",\n        \"detailedLog\": \"http://internal.aiqua.appier.info/log/crunner-inweb/toggle/detailed-log/2021-06-25/20210625-084857-794098-2400.txt\",\n        \"total_records\": 4333,\n        \"logFilePath\": \"http://internal.aiqua.appier.info/log/crunner-inweb/toggle/log/2021-06-25/20210625-084857-794098-2400.txt\",\n        \"last_refresh_end_datetime\": \"2021-06-27 18:22:16\",\n        \"campaign_start_time\": \"2021-06-25 08:48:57\"\n    },\n    \"account\": \"2400\"\n}' % (Active, int(on_the_day_StartTimestamp), int(on_the_day_EndTimestamp), PercentString) 
reminder_payload = '{\n    \"active\": \"%s\",\n    \"id\": 1212936,\n    \"type1\": \"inweb\",\n    \"name\": \"【全站】更新網站 提醒結帳\",\n    \"description\": \"\",\n    \"channel\": \"push\",\n    \"type\": \"web\",\n    \"include_segments\": [\n        111172\n    ],\n    \"exclude_segments\": [],\n    \"segment\": 111172,\n    \"includesegment\": null,\n    \"excludesegment\": null,\n    \"creative\": {\n        \"type\": \"inweb\",\n        \"triggerType\": \"userEvent\",\n        \"startTime\": %d,\n        \"endTime\": %d,\n        \"include_new_users\": true,\n        \"allow_coexisted\": false,\n        \"whenCond\": {\n            \"eventName\": \"page_viewed\",\n            \"operator\": \"OR\",\n            \"conditions\": [\n                {\n                    \"value\": \"ConfirmOrder\",\n                    \"param\": \"url\",\n                    \"op\": \"contains\"\n                },\n                {\n                    \"value\": \"FillOrderInfo\",\n                    \"param\": \"url\",\n                    \"op\": \"contains\"\n                }\n            ]\n        },\n        \"blockConds\": [\n            {\n                \"eventName\": \"page_viewed\",\n                \"operator\": \"AND\",\n                \"conditions\": [\n                    {\n                        \"value\": \"https://greenbox.tw/Blog/BlogNew\",\n                        \"param\": \"url\",\n                        \"op\": \"equals\"\n                    }\n                ]\n            },\n            {\n                \"eventName\": \"page_viewed\",\n                \"operator\": \"AND\",\n                \"conditions\": [\n                    {\n                        \"value\": \"https://greenbox.tw/Baby/About\",\n                        \"param\": \"url\",\n                        \"op\": \"equals\"\n                    }\n                ]\n            }\n        ],\n        \"scheduledType\": \"once\",\n        \"maxNumTimesToShow\": 1,\n        \"audiencePlatform\": {\n            \"android\": true,\n            \"ios\": true,\n            \"others\": true\n        },\n        \"abCreativeVariants\": [\n            {\n                \"creativeType\": \"multipleActions\",\n                \"variantName\": \"實驗組別 1\",\n                \"maxLeadSubmitCount\": 1,\n                \"multipleActions\": {\n                    \"showOverlay\": false,\n                    \"location\": \"bottom-right\",\n                    \"popupWidth\": 320,\n                    \"popupHeight\": 120,\n                    \"marginTop\": 0,\n                    \"marginRight\": 20,\n                    \"marginBottom\": 0,\n                    \"marginLeft\": 0,\n                    \"popupBackgroundColor\": \"rgba(255, 255, 255, 1)\",\n                    \"hasImage\": false,\n                    \"imageRatio\": \"1:1\",\n                    \"imgSrc\": \"https://cdn.qgraph.io/img/hosting/6f8b1ea135c988f5f915/1S0L1S7Jbm0L1mwr1huObSwAdxrxjS0l1HrxblgN0Hrxbo5ljgrxbS8l1KrxbS8J1KrxbSwM0xrxbSkJ0YJrbo7r1okJbo7O.jpg\",\n                    \"imageFit\": \"cover\",\n                    \"title\": \"網站即將更新\",\n                    \"titleColor\": \"rgba(39, 172, 58, 1)\",\n                    \"message\": \"請注意，網站預計將於今日15：00更新，請務必在此之前完成結帳，如有未完成消費，請稍等10分鐘後再次上站，如造成不便深感抱歉！\",\n                    \"messageColor\": \"rgba(139, 87, 42, 1)\",\n                    \"hasCallToAction\": false,\n                    \"closeButtonBackgroundSize\": 24,\n                    \"closeButtonBackgroundColor\": \"rgba(255, 255, 255, 1)\",\n                    \"closeButtonIconSize\": 12,\n                    \"closeButtonIconColor\": \"rgba(139, 87, 42, 1)\",\n                    \"callToActions\": [\n                        {\n                            \"callToActionText\": \"立即參加活動>\",\n                            \"callToActionTextColor\": \"rgba(255, 255, 255, 1)\",\n                            \"fontWeight\": 400,\n                            \"callToActionMethod\": \"openUrl\",\n                            \"redirectUrl\": \"https://greenbox.tw/Activity/ShoppingFestival\",\n                            \"callToActionClass\": \"primary\",\n                            \"callToActionBackgroundColor\": \"rgba(144, 195, 31, 1)\",\n                            \"borderRadius\": 20,\n                            \"isTargetBlank\": false\n                        }\n                    ]\n                }\n            }\n        ],\n        \"isAB\": false,\n        \"delayTime\": 3\n    },\n    \"priority\": 7,\n    \"event\": \"nothing\",\n    \"trigger\": \"nothing\",\n    \"stats\": {\n        \"last_refresh_start_datetime\": \"2021-08-15 18:41:06\",\n        \"total_seg_duration\": 0,\n        \"pid\": \"1240\",\n        \"detailedLog\": \"http://internal.aiqua.appier.info/log/crunner-inweb/toggle/detailed-log/2021-08-13/20210813-072431-1212936-2400-1240.txt\",\n        \"total_records\": 2,\n        \"logFilePath\": \"http://internal.aiqua.appier.info/log/crunner-inweb/toggle/log/2021-08-13/20210813-072431-1212936-2400-1240.txt\",\n        \"last_refresh_end_datetime\": \"2021-08-15 18:41:07\",\n        \"campaign_start_time\": \"2021-08-13 07:24:31\"\n    },\n    \"account\": \"2400\"\n}' % (Active, int(reminder_StartTimestamp), int(reminder_EndTimestamp)) 

headers = {
  'Authorization': 'Token ad658f4e0ab41166f3a064e157e848f38f785e84',
  'appId': '6f8b1ea135c988f5f915',
  'Content-Type': 'application/json',
  'Cookie': '__cfduid=df443e78b8522bc703fd2099de7ba92991615863739'
}

reminder_response = requests.request("PUT", reminder_url, headers=headers, data = reminder_payload.encode('utf-8'))

print(reminder_response.text.encode('utf8'))

